######
### Global
######

# Update PATH
export PATH=$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH

{{- if (eq .chezmoi.distro.name "darwin") -}}
export PATH=/opt/homebrew/bin:/opt/homebrew/sbin:$PATH
{{- end -}}

######
### oh-my-zsh
######

# Path to your oh-my-zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# oh-my-zsh theme to use
ZSH_THEME="robbyrussell"

# oh-my-zsh plugins to load
plugins=(1password-op brew colored-man-pages colorize docker-compose docker dotnet dotenv git iterm2 macos node npm nvm pip yarn zsh-syntax-highlighting zsh-autosuggestions)

# Uncomment the following line to use case-sensitive completion.
# CASE_SENSITIVE="true"

# Uncomment the following line to use hyphen-insensitive completion.
# Case-sensitive completion must be off. _ and - will be interchangeable.
# HYPHEN_INSENSITIVE="true"

# Disable oh-my-zsh update (handled via chezmoi)
zstyle ':omz:update' mode disabled  # disable automatic updates

# Uncomment the following line to enable command auto-correction.
ENABLE_CORRECTION="true"

# Uncomment the following line to display red dots whilst waiting for completion.
COMPLETION_WAITING_DOTS="true"

source $ZSH/oh-my-zsh.sh

######
### User Configuration
######

# Set nano as default editor
export EDITOR='nano'

# Homebrew zsh hooks
if [ "$(command -v brew)" ]; then
    eval "$(brew shellenv)"
fi

# Starship zsh hooks
if [ "$(command -v starship)" ]; then
    eval "$(starship init zsh)"
fi

# Direnv zsh hooks
if [ "$(command -v direnv)" ]; then
    eval "$(direnv hook zsh)"
fi

# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('{{ .chezmoi.homeDir }}/mambaforge/bin/conda' 'shell.zsh' 'hook' 2>/dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "{{ .chezmoi.homeDir }}/mambaforge/etc/profile.d/conda.sh" ]; then
        . "{{ .chezmoi.homeDir }}/mambaforge/etc/profile.d/conda.sh"
    else
        export PATH="{{ .chezmoi.homeDir }}/mambaforge/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# Kubeconfig
export KUBECONFIG=~/.kube/config

# Check if 1Password CLI is installed
if [ "$(command -v op)" ]; then
    # Set environment variable for chezmoi
    export OP_ENABLED=true

    # Add zsh hooks
    eval "$(op completion zsh)"
    compdef _op op
fi
